---
layout: post
title: "Quick Sort summary - Part 4 - Related Questions"
description: ""
categories: [algorithm]
---

# Pre-Compute 

One of the core value of our system is to deliver the right messages to the right people at the right time. Our product allows users to set up automated emails, which will be sent at a suitable time in the future. The emails are customised to each specific recipient based on their newest data at the time they receive the email, for example the current customer status, whether that customer is an active or lost customer at that time, how many policies he/she has or the total value they have spent until that time.

Our system operates based on a queue of all activities that will happen in the future. The system needs to calculate the execution time of all those events to trigger the specific actions targeting the specific set of customers. The emails are also considered as one kind of events in that queue and will be taken out to execute when the time expires.

Our initial implementation simply takes out the events that need to be executed and perform those specific actions. For emails, the task is to take out the specific email, wrap all the necessary data, from the recipient data, the company information and the email template logic. The system then needs to combine all those information and perform a lot of complex logic from the email template in order to produce the final HTML email content to send to Mailgun. 

schedules all the emails with empty content at first, and then wait until the sending time to process all the email content with the newest data at that time. This solution caused a lot of delay in the email sending time. The reason is that there are a lot of emails sent at the same time. Our research shows that the customers are more likely to read and click on the email contents if they are sent at some specific time in the day (business logic). That breaks our core business value that we promised to our clients so we had to come up with a new solutions.